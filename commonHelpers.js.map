{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import axios from 'axios';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nconst apiKey = '42062449-cea48752956c1d9094f31db98';\nconst searchForm = document.querySelector('form.search-form');\nconst loaderElement = document.querySelector('.loader');\nconst imagesList = document.querySelector('.gallery');\nconst loadMoreButtonBlock = document.querySelector('.load-more-div');\nconst loadMoreButton = document.querySelector('.load-more-div button');\nconst lightboxInstance = new SimpleLightbox('.gallery .gallery-link', {\n  captions: true,\n  captionsData: 'alt',\n  captionPosition: 'bottom',\n});\nconst perPage = 15;\nlet userQuery;\nlet page = 1;\n\nasync function handleSubmit(event) {\n  event.preventDefault();\n\n  const inputValue = event.target.elements['search-field'].value;\n  if (inputValue.trim().length === 0) {\n    return;\n  }\n\n  imagesList.innerHTML = '';\n\n  page = 1;\n  hideButton();\n  showLoader();\n\n  userQuery = encodeURIComponent(inputValue);\n\n  try {\n    const firstPageResponse = await fetchImages(userQuery);\n    const totalImagesCount = firstPageResponse.data.totalHits;\n\n    if (totalImagesCount === 0) {\n      hideLoader();\n      iziToast.error({\n        position: 'topRight',\n        title: '',\n        message:\n          'Sorry, there are no images matching your search query. Please, try again!',\n      });\n    } else {\n      hideLoader();\n      const imagesInitialArray = firstPageResponse.data.hits;\n      const imagesResultingArray = mapResponseData(imagesInitialArray);\n      renderImages(imagesResultingArray);\n      searchForm.reset();\n      if (totalImagesCount > perPage) {\n        showButton();\n      }\n    }\n  } catch (error) {\n    console.log(error);\n    hideLoader();\n  }\n}\nsearchForm.addEventListener('submit', handleSubmit);\n\nasync function handleClick(event) {\n  event.preventDefault();\n  hideButton();\n  showLoader();\n\n  try {\n    page += 1;\n\n    const subsequentPageResponse = await fetchImages(userQuery);\n    const totalImagesCount = subsequentPageResponse.data.totalHits;\n    const totalPagesCount = Math.ceil(totalImagesCount / perPage);\n\n    if (page >= totalPagesCount) {\n      hideLoader();\n      return iziToast.error({\n        position: 'topRight',\n        message: \"We're sorry, but you've reached the end of search results.\",\n      });\n    } else if (page === totalPagesCount) {\n      hideLoader();\n      const imagesInitialArray = subsequentPageResponse.data.hits;\n      const imagesResultingArray = mapResponseData(imagesInitialArray);\n      renderImages(imagesResultingArray);\n      return iziToast.error({\n        position: 'topRight',\n        message: \"We're sorry, but you've reached the end of search results.\",\n      });\n    } else {\n      hideLoader();\n      showButton();\n      const imagesInitialArray = subsequentPageResponse.data.hits;\n      const imagesResultingArray = mapResponseData(imagesInitialArray);\n\n      renderImages(imagesResultingArray);\n\n      const card = document.querySelector('.gallery-card');\n      const cardDOMRect = card.getBoundingClientRect();\n      const options = {\n        top: cardDOMRect.height * 2,\n        behavior: 'smooth',\n      };\n      window.scrollBy(options);\n    }\n  } catch (error) {\n    console.log(error);\n  }\n}\nloadMoreButton.addEventListener('click', handleClick);\n\nasync function fetchImages(userQuery) {\n  try {\n    const response = await axios.get(\n      `https://pixabay.com/api/?key=${apiKey}&q=${userQuery}&image_type=photo&orientation=horizontal&safesearch=true&per_page=${perPage}&page=${page}`\n    );\n    return response;\n  } catch (error) {\n    throw new Error(error);\n  }\n}\n\nfunction renderImages(imagesResultingArray) {\n  const liElements = imagesResultingArray\n    .map(image => {\n      return `<li class=\"gallery-card\"><a class=\"gallery-link\" href=\"${image.href}\"><img class=\"gallery-image\" src=\"${image.src}\" alt=\"${image.alt}\" /><div class=\"image-stats-card\"><div class=\"image-stats-block\"><p>Likes</p>${image.likes}</div><div class=\"image-stats-block\"><p>Views</p>${image.views}</div><div class=\"image-stats-block\"><p>Comments</p>${image.comments}</div><div class=\"image-stats-block\"><p>Downloads</p>${image.downloads}</div></div></a></li>`;\n    })\n    .join('');\n  imagesList.insertAdjacentHTML('beforeend', liElements);\n\n  lightboxInstance.refresh();\n}\n\nfunction mapResponseData(hits) {\n  return hits.map(eachObject => {\n    return {\n      href: eachObject.largeImageURL,\n      src: eachObject.webformatURL,\n      alt: eachObject.tags,\n      likes: eachObject.likes,\n      views: eachObject.views,\n      comments: eachObject.comments,\n      downloads: eachObject.downloads,\n    };\n  });\n}\n\nfunction showLoader() {\n  loaderElement.style.display = 'block';\n}\nfunction hideLoader() {\n  loaderElement.style.display = 'none';\n}\nfunction showButton() {\n  loadMoreButtonBlock.style.display = 'flex';\n}\nfunction hideButton() {\n  loadMoreButtonBlock.style.display = 'none';\n}\n"],"names":["apiKey","searchForm","loaderElement","imagesList","loadMoreButtonBlock","loadMoreButton","lightboxInstance","SimpleLightbox","perPage","userQuery","page","handleSubmit","event","inputValue","hideButton","showLoader","firstPageResponse","fetchImages","totalImagesCount","hideLoader","iziToast","imagesInitialArray","imagesResultingArray","mapResponseData","renderImages","showButton","error","handleClick","subsequentPageResponse","totalPagesCount","options","axios","liElements","image","hits","eachObject"],"mappings":"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"}