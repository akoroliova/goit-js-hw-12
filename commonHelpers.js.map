{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import axios from 'axios'; //https://github.com/axios/axios?tab=readme-ov-file#table-of-contents\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nconst apiKey = '42062449-cea48752956c1d9094f31db98';\nconst searchForm = document.querySelector('form.search-form');\nconst loaderElement = document.querySelector('.loader');\nconst imagesList = document.querySelector('.gallery');\nconst loadMoreButtonBlock = document.querySelector('.load-more-div');\nconst loadMoreButton = document.querySelector('.load-more-div button');\nconst lightboxInstance = new SimpleLightbox('.gallery .gallery-link', {\n  captions: true,\n  captionsData: 'alt',\n  captionPosition: 'bottom',\n});\nconst perPage = 15;\nlet userQuery;\nlet page = 1;\n\nasync function handleSubmit(event) {\n  event.preventDefault();\n  imagesList.innerHTML = '';\n  page = 1;\n  hideButton();\n  showLoader();\n\n  //Поле введення search-field вибирається безпосередньо за його іменем у event.target.elements['search-field'].value. Хоча це працює, варто було б згадати важливість перевірки введених даних перед їх кодуванням та передачею у виклик API.\n  //Запит не повинен відправлятися при порожньому рядку введення (або якщо просто використовується пробіл). Обов'язково додаємо перевірку, чи є щось в інпуті.\n  userQuery = encodeURIComponent(event.target.elements['search-field'].value);\n\n  try {\n    const firstPageResponse = await fetchImages(userQuery);\n    const totalImages = firstPageResponse.data.total;\n\n    if (totalImages === 0) {\n      hideLoader();\n      iziToast.error({\n        position: 'topRight',\n        title: '',\n        message:\n          'Sorry, there are no images matching your search query. Please, try again!',\n      });\n    } else {\n      hideLoader();\n      const imagesInitialArray = firstPageResponse.data.hits;\n      const imagesResultingArray = mapResponseData(imagesInitialArray);\n      renderImages(imagesResultingArray);\n      searchForm.reset();\n      if (totalImages > perPage) {\n        showButton();\n      }\n    }\n  } catch (error) {\n    console.log(error);\n    hideLoader();\n  }\n}\nsearchForm.addEventListener('submit', handleSubmit);\n\nasync function handleClick(event) {\n  event.preventDefault();\n  hideButton();\n  showLoader();\n\n  try {\n    page += 1;\n\n    const subsequentResponse = await fetchImages(userQuery);\n    const totalImagesCount = subsequentResponse.data.total;\n    const totalPagesCount = Math.ceil(totalImagesCount / perPage);\n\n    if (page >= totalPagesCount) {\n      hideLoader();\n      return iziToast.error({\n        position: 'topRight',\n        message: \"We're sorry, but you've reached the end of search results.\",\n      });\n    } else {\n      hideLoader();\n      showButton();\n      const imagesInitialArray = subsequentResponse.data.hits;\n      const imagesResultingArray = mapResponseData(imagesInitialArray);\n      renderImages(imagesResultingArray);\n    }\n  } catch (error) {\n    console.log(error);\n  }\n}\nloadMoreButton.addEventListener('click', handleClick);\n\nasync function fetchImages(userQuery) {\n  try {\n    const response = await axios.get(\n      `https://pixabay.com/api/?key=${apiKey}&q=${userQuery}&image_type=photo&orientation=horizontal&safesearch=true&per_page=${perPage}&page=${page}`\n    );\n    return response;\n  } catch (error) {\n    throw new Error(error);\n  }\n}\n\nfunction renderImages(imagesResultingArray) {\n  const liElements = imagesResultingArray\n    .map(image => {\n      return `<li class=\"gallery-card\"><a class=\"gallery-link\" href=\"${image.href}\"><img class=\"gallery-image\" src=\"${image.src}\" alt=\"${image.alt}\" /><div class=\"image-stats-card\"><div class=\"image-stats-block\"><p>Likes</p>${image.likes}</div><div class=\"image-stats-block\"><p>Views</p>${image.views}</div><div class=\"image-stats-block\"><p>Comments</p>${image.comments}</div><div class=\"image-stats-block\"><p>Downloads</p>${image.downloads}</div></div></a></li>`;\n    })\n    .join('');\n  imagesList.insertAdjacentHTML('beforeend', liElements);\n\n  lightboxInstance.refresh();\n}\n\nfunction mapResponseData(hits) {\n  return hits.map(eachObject => {\n    return {\n      href: eachObject.largeImageURL,\n      src: eachObject.webformatURL,\n      alt: eachObject.tags,\n      likes: eachObject.likes,\n      views: eachObject.views,\n      comments: eachObject.comments,\n      downloads: eachObject.downloads,\n    };\n  });\n}\n\nfunction showLoader() {\n  loaderElement.style.display = 'block';\n}\nfunction hideLoader() {\n  loaderElement.style.display = 'none';\n}\nfunction showButton() {\n  loadMoreButtonBlock.style.display = 'flex';\n}\nfunction hideButton() {\n  loadMoreButtonBlock.style.display = 'none';\n}\n"],"names":["apiKey","searchForm","loaderElement","imagesList","loadMoreButtonBlock","loadMoreButton","lightboxInstance","SimpleLightbox","perPage","userQuery","page","handleSubmit","event","hideButton","showLoader","firstPageResponse","fetchImages","totalImages","hideLoader","iziToast","imagesInitialArray","imagesResultingArray","mapResponseData","renderImages","showButton","error","handleClick","subsequentResponse","totalImagesCount","totalPagesCount","axios","liElements","image","hits","eachObject"],"mappings":"owBAMA,MAAMA,EAAS,qCACTC,EAAa,SAAS,cAAc,kBAAkB,EACtDC,EAAgB,SAAS,cAAc,SAAS,EAChDC,EAAa,SAAS,cAAc,UAAU,EAC9CC,EAAsB,SAAS,cAAc,gBAAgB,EAC7DC,EAAiB,SAAS,cAAc,uBAAuB,EAC/DC,EAAmB,IAAIC,EAAe,yBAA0B,CACpE,SAAU,GACV,aAAc,MACd,gBAAiB,QACnB,CAAC,EACKC,EAAU,GAChB,IAAIC,EACAC,EAAO,EAEX,eAAeC,EAAaC,EAAO,CACjCA,EAAM,eAAc,EACpBT,EAAW,UAAY,GACvBO,EAAO,EACPG,IACAC,IAIAL,EAAY,mBAAmBG,EAAM,OAAO,SAAS,cAAc,EAAE,KAAK,EAE1E,GAAI,CACF,MAAMG,EAAoB,MAAMC,EAAYP,CAAS,EAC/CQ,EAAcF,EAAkB,KAAK,MAE3C,GAAIE,IAAgB,EAClBC,IACAC,EAAS,MAAM,CACb,SAAU,WACV,MAAO,GACP,QACE,2EACV,CAAO,MACI,CACLD,IACA,MAAME,EAAqBL,EAAkB,KAAK,KAC5CM,EAAuBC,EAAgBF,CAAkB,EAC/DG,EAAaF,CAAoB,EACjCpB,EAAW,MAAK,EACZgB,EAAcT,GAChBgB,GAEH,CACF,OAAQC,EAAO,CACd,QAAQ,IAAIA,CAAK,EACjBP,GACD,CACH,CACAjB,EAAW,iBAAiB,SAAUU,CAAY,EAElD,eAAee,EAAYd,EAAO,CAChCA,EAAM,eAAc,EACpBC,IACAC,IAEA,GAAI,CACFJ,GAAQ,EAER,MAAMiB,EAAqB,MAAMX,EAAYP,CAAS,EAChDmB,EAAmBD,EAAmB,KAAK,MAC3CE,EAAkB,KAAK,KAAKD,EAAmBpB,CAAO,EAE5D,GAAIE,GAAQmB,EACV,OAAAX,IACOC,EAAS,MAAM,CACpB,SAAU,WACV,QAAS,4DACjB,CAAO,EACI,CACLD,IACAM,IACA,MAAMJ,EAAqBO,EAAmB,KAAK,KAC7CN,EAAuBC,EAAgBF,CAAkB,EAC/DG,EAAaF,CAAoB,CAClC,CACF,OAAQI,EAAO,CACd,QAAQ,IAAIA,CAAK,CAClB,CACH,CACApB,EAAe,iBAAiB,QAASqB,CAAW,EAEpD,eAAeV,EAAYP,EAAW,CACpC,GAAI,CAIF,OAHiB,MAAMqB,EAAM,IAC3B,gCAAgC9B,CAAM,MAAMS,CAAS,qEAAqED,CAAO,SAASE,CAAI,EACpJ,CAEG,OAAQe,EAAO,CACd,MAAM,IAAI,MAAMA,CAAK,CACtB,CACH,CAEA,SAASF,EAAaF,EAAsB,CAC1C,MAAMU,EAAaV,EAChB,IAAIW,GACI,0DAA0DA,EAAM,IAAI,qCAAqCA,EAAM,GAAG,UAAUA,EAAM,GAAG,gFAAgFA,EAAM,KAAK,oDAAoDA,EAAM,KAAK,uDAAuDA,EAAM,QAAQ,wDAAwDA,EAAM,SAAS,uBACnb,EACA,KAAK,EAAE,EACV7B,EAAW,mBAAmB,YAAa4B,CAAU,EAErDzB,EAAiB,QAAO,CAC1B,CAEA,SAASgB,EAAgBW,EAAM,CAC7B,OAAOA,EAAK,IAAIC,IACP,CACL,KAAMA,EAAW,cACjB,IAAKA,EAAW,aAChB,IAAKA,EAAW,KAChB,MAAOA,EAAW,MAClB,MAAOA,EAAW,MAClB,SAAUA,EAAW,SACrB,UAAWA,EAAW,SAC5B,EACG,CACH,CAEA,SAASpB,GAAa,CACpBZ,EAAc,MAAM,QAAU,OAChC,CACA,SAASgB,GAAa,CACpBhB,EAAc,MAAM,QAAU,MAChC,CACA,SAASsB,GAAa,CACpBpB,EAAoB,MAAM,QAAU,MACtC,CACA,SAASS,GAAa,CACpBT,EAAoB,MAAM,QAAU,MACtC"}